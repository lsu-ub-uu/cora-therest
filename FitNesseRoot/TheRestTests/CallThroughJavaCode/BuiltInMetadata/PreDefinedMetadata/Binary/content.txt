!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.therest.fitnesse |

!1 !-BinaryTest-!
A test that first reads all predefined metadata needed to be able to add binary data to the system, and then tests adding and updating images.

!2 Read metadata defined in code to make sure it is correct
!***> Read textVariables (filenameTextVar, filesizeTextVar)

!| RecordEndpointFixture |
| type | id | testReadRecord? | getStatusType? |
| metadataTextVariable | filenameTextVar | {"record":{"data":{"children":[{"children":[{"name":"id","value":"filenameTextVar"},{"name":"type","value":"metadataTextVariable"},{"name":"createdBy","value":"userId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"fileName"},{"name":"textId","value":"filenameTextVarText"},{"name":"defTextId","value":"filenameTextVarDefText"},{"name":"regEx","value":"(.*)"}],"name":"metadata","attributes":{"type":"textVariable"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataTextVariable/filenameTextVar","accept":"application/uub+record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataTextVariable/filenameTextVar","accept":"application/uub+record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/metadataTextVariable/filenameTextVar"}}}} | OK |
| metadataTextVariable | filesizeTextVar | {"record":{"data":{"children":[{"children":[{"name":"id","value":"filesizeTextVar"},{"name":"type","value":"metadataTextVariable"},{"name":"createdBy","value":"userId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"fileSize"},{"name":"textId","value":"filesizeTextVarText"},{"name":"defTextId","value":"filesizeTextVarDefText"},{"name":"regEx","value":"(.*)"}],"name":"metadata","attributes":{"type":"textVariable"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataTextVariable/filesizeTextVar","accept":"application/uub+record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataTextVariable/filesizeTextVar","accept":"application/uub+record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/metadataTextVariable/filesizeTextVar"}}}} | OK |

*!
!***> Read metadataGroups (recordInfoGroup, binaryGroup, recordInfoAutogeneratedNewGroup, binaryNewGroup)

!| RecordEndpointFixture |
| type | id | testReadRecord? | getStatusType? |
| metadataGroup | recordInfoGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"recordInfoGroup"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"userId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"recordInfo"},{"name":"textId","value":"recordInfoText"},{"name":"defTextId","value":"recordInfoDefText"},{"children":[{"repeatId":"1","children":[{"name":"ref","value":"idTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"2","children":[{"name":"ref","value":"typeTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"3","children":[{"name":"ref","value":"createdByTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"4","children":[{"name":"ref","value":"dataDividerLink"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/recordInfoGroup","accept":"application/uub+record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/recordInfoGroup","accept":"application/uub+record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/metadataGroup/recordInfoGroup"}}}} | OK |
| metadataGroup | binaryGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"binaryGroup"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"userId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"binary"},{"name":"textId","value":"binaryGroupText"},{"name":"defTextId","value":"binaryGroupDefText"},{"children":[{"repeatId":"1","children":[{"name":"ref","value":"recordInfoGroup"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"2","children":[{"name":"ref","value":"filenameTextVar"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"3","children":[{"name":"ref","value":"filesizeTextVar"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"4","children":[{"name":"ref","value":"mimetypeCollectionVar"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/binaryGroup","accept":"application/uub+record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/binaryGroup","accept":"application/uub+record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/metadataGroup/binaryGroup"}}}} | OK |
| metadataGroup | recordInfoAutogeneratedNewGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"recordInfoAutogeneratedNewGroup"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"userId"}],"name":"recordInfo"},{"name":"nameInData","value":"recordInfo"},{"name":"textId","value":"recordInfoAutogeneratedNewText"},{"name":"defTextId","value":"recordInfoAutogeneratedNewDefText"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"dataDividerLink"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/recordInfoAutogeneratedNewGroup","accept":"application/uub+record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/recordInfoAutogeneratedNewGroup","accept":"application/uub+record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/metadataGroup/recordInfoAutogeneratedNewGroup"}}}} | OK |
| metadataGroup | binaryNewGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"binaryNewGroup"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"userId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"binary"},{"name":"textId","value":"binaryNewGroupText"},{"name":"defTextId","value":"binaryNewGroupDefText"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"recordInfoAutogeneratedNewGroup"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"1","children":[{"name":"ref","value":"filenameTextVar"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"2","children":[{"name":"ref","value":"filesizeTextVar"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"3","children":[{"name":"ref","value":"mimetypeCollectionVar"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/binaryNewGroup","accept":"application/uub+record+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/binaryNewGroup","accept":"application/uub+record+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/metadataGroup/binaryNewGroup"}}}} | |

*!
!***> Read recordType (binary, image)

!| RecordEndpointFixture |
| type | id | testReadRecord? | getStatusType? |
| recordType | binary | {"record":{"data":{"children":[{"name":"metadataId","value":"binaryGroup"},{"name":"abstract","value":"false"},{"children":[{"name":"id","value":"binary"},{"name":"type","value":"recordType"},{"name":"createdBy","value":"userId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"presentationViewId","value":"binaryViewPGroup"},{"name":"presentationFormId","value":"binaryFormPGroup"},{"name":"newMetadataId","value":"binaryNewGroup"},{"name":"newPresentationFormId","value":"binaryFormNewPGroup"},{"name":"menuPresentationViewId","value":"binaryMenuPGroup"},{"name":"listPresentationViewId","value":"binaryListPGroup"},{"name":"searchMetadataId","value":"binarySearchGroup"},{"name":"searchPresentationFormId","value":"binaryFormSearchPGroup"},{"name":"userSuppliedId","value":"false"},{"name":"permissionKey","value":"RECORDTYPE_BINARY"},{"name":"selfPresentationViewId","value":"binaryViewSelfPGroup"}],"name":"recordType"},"actionLinks":{"search":{"requestMethod":"GET","rel":"search","url":"http://localhost:8080/therest/rest/record/binary/","accept":"application/uub+recordList+json"},"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/recordType/binary","accept":"application/uub+record+json"},"create_by_upload":{"requestMethod":"POST","rel":"create_by_upload","contentType":"multipart/form-data","url":"http://localhost:8080/therest/rest/record/binary/"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/recordType/binary","accept":"application/uub+record+json"},"create":{"requestMethod":"POST","rel":"create","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/binary/","accept":"application/uub+record+json"},"list":{"requestMethod":"GET","rel":"list","url":"http://localhost:8080/therest/rest/record/binary/","accept":"application/uub+recordList+json"},"delete":{"requestMethod":"DELETE","rel":"delete","url":"http://localhost:8080/therest/rest/record/recordType/binary"}}}} | OK |

*!
!2 Test with new image
!***> Create data of recordType image (autogeneratedId)

!| RecordEndpointFixture |
| type | json | testCreateRecord? | getStatusType? | getCreatedId? |
| binary | {"name":"binary","children":[{"name":"recordInfo","children":[{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"}]},{"name":"fileName","value":"myFile.jpg"},{"name":"fileSize","value":"100234"}]} | | CREATED | $createdId= |

*!
!***> List data(binary, image)

!| RecordEndpointFixture |
| type | testReadRecordList? | getStatusType? |
| binary | | OK |

*!
!***> Update data of recordType image

!| RecordEndpointFixture |
| type | id | json | testUpdateRecord? | getStatusType? |
| binary | $createdId | {"children":[{"name":"fileName","value":"myFile.jpg"},{"name":"fileSize","value":"100234"},{"children":[{"name":"id","value":"$createdId"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"name":"dataDivider"},{"name":"type","value":"binary"},{"name":"createdBy","value":"userId"}],"name":"recordInfo"}],"name":"binary"} | | OK |

*!
