!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.therest.fitnesse |

!1 !-UserTest-!
A test that  reads all predefined metadata needed to be able to create a concrete recordType user

!2 Read predefined metadata to make sure it is correct
!***> Read metadataGroups for user (userNewGroup, userGroup)

!| RecordEndpointFixture |
| type | id | testReadRecord? | getStatusType? |
| metadataGroup | userNewGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"userNewGroup"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"12345"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"user"},{"name":"textId","value":"userNewGroupText"},{"name":"defTextId","value":"userNewGroupDefText"},{"name":"refParentId","value":"userGroup"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"recordInfoNewGroup"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"4","children":[{"name":"ref","value":"userIdTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"5","children":[{"name":"ref","value":"userFirstnameTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"6","children":[{"name":"ref","value":"userLastnameTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"3","children":[{"name":"ref","value":"userRoleRelationGroup"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"X"}],"name":"childReference"},{"repeatId":"2","children":[{"name":"ref","value":"activeStatusCollectionVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/userNewGroup","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataGroup/userNewGroup/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/userNewGroup","accept":"application/uub+record+json"}}}} | OK |
| metadataGroup | userGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"userGroup"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"12345"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"user"},{"name":"textId","value":"userGroupText"},{"name":"defTextId","value":"userGroupDefText"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"recordInfoGroup"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"4","children":[{"name":"ref","value":"userIdTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"5","children":[{"name":"ref","value":"userFirstnameTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"6","children":[{"name":"ref","value":"userLastnameTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"},{"repeatId":"3","children":[{"name":"ref","value":"userRoleRelationGroup"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"X"}],"name":"childReference"},{"repeatId":"2","children":[{"name":"ref","value":"activeStatusCollectionVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/userGroup","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataGroup/userGroup/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/userGroup","accept":"application/uub+record+json"}}}} | OK |

*!
!***> Read recordRelations(userRoleRecordRelation) that is used in metadata groups for user, and the link(userRoleLink) and groups (including child groups) used in the recordRelation

!| RecordEndpointFixture |
| type | id | testReadRecord? | getStatusType? |
| metadataRecordRelation | userRoleRecordRelation | {"record":{"data":{"children":[{"children":[{"name":"id","value":"userRoleRecordRelation"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"},{"name":"type","value":"metadataRecordRelation"},{"name":"createdBy","value":"12345"}],"name":"recordInfo"},{"name":"nameInData","value":"userRole"},{"name":"textId","value":"userRoleRecordRelationText"},{"name":"defTextId","value":"userRoleRecordRelationDefText"},{"name":"refRecordLinkId","value":"userRoleLink"},{"name":"refMetadataGroupId","value":"userRoleRulePartGroup"}],"name":"metadata","attributes":{"type":"recordRelation"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataRecordRelation/userRoleRecordRelation","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataRecordRelation/userRoleRecordRelation/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataRecordRelation/userRoleRecordRelation","accept":"application/uub+record+json"}}}} | OK |
| metadataRecordLink | userRoleLink | {"record":{"data":{"children":[{"children":[{"name":"id","value":"userRoleLink"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"},{"name":"type","value":"metadataRecordLink"},{"name":"createdBy","value":"12345"}],"name":"recordInfo"},{"name":"nameInData","value":"userRole"},{"name":"textId","value":"userRoleLinktText"},{"name":"defTextId","value":"userRoleLinkDefText"},{"name":"linkedRecordType","value":"permissionRole"}],"name":"metadata","attributes":{"type":"recordLink"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataRecordLink/userRoleLink","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataRecordLink/userRoleLink/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataRecordLink/userRoleLink","accept":"application/uub+record+json"}}}} | OK |
| metadataGroup | userRoleRulePartGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"userRoleRulePartGroup"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"12345"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"}],"name":"recordInfo"},{"name":"nameInData","value":"userRoleRulePart"},{"name":"textId","value":"userRoleRulePartGroupText"},{"name":"defTextId","value":"userRoleRulePartGroupDefText"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"permissionRulePartGroup"},{"name":"repeatMin","value":"0"},{"name":"repeatMax","value":"1"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/userRoleRulePartGroup","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataGroup/userRoleRulePartGroup/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/userRoleRulePartGroup","accept":"application/uub+record+json"}}}} | OK |
| metadataGroup | permissionRulePartUserIdGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"permissionRulePartUserIdGroup"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"12345"}],"name":"recordInfo"},{"name":"nameInData","value":"permissionRulePart"},{"name":"textId","value":"permissionRulePartUserIdGroupText"},{"name":"defTextId","value":"permissionRulePartUserIdGroupDefText"},{"name":"refParentId","value":"permissionRulePartGroup"},{"children":[{"repeatId":"0","name":"ref","value":"permissionRulePartTypeUserIdCollectionVar"}],"name":"attributeReferences"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"permissionRulePartValueTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"X"}],"name":"childReference"}],"name":"childReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/permissionRulePartUserIdGroup","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataGroup/permissionRulePartUserIdGroup/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/permissionRulePartUserIdGroup","accept":"application/uub+record+json"}}}} | OK |
| metadataGroup | permissionRulePartOrganisationGroup | {"record":{"data":{"children":[{"children":[{"name":"id","value":"permissionRulePartOrganisationGroup"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}],"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/system/cora","accept":"application/uub+record+json"}},"name":"dataDivider"},{"name":"type","value":"metadataGroup"},{"name":"createdBy","value":"12345"}],"name":"recordInfo"},{"name":"nameInData","value":"permissionRulePart"},{"name":"textId","value":"permissionRulePartOrganisationGroupText"},{"name":"defTextId","value":"permissionRulePartOrganisationGroupDefText"},{"children":[{"repeatId":"0","children":[{"name":"ref","value":"permissionRulePartValueTextVar"},{"name":"repeatMin","value":"1"},{"name":"repeatMax","value":"X"}],"name":"childReference"}],"name":"childReferences"},{"name":"refParentId","value":"permissionRulePartGroup"},{"children":[{"repeatId":"0","name":"ref","value":"permissionRulePartTypeOrganisationCollectionVar"}],"name":"attributeReferences"}],"name":"metadata","attributes":{"type":"group"}},"actionLinks":{"read":{"requestMethod":"GET","rel":"read","url":"http://localhost:8080/therest/rest/record/metadataGroup/permissionRulePartOrganisationGroup","accept":"application/uub+record+json"},"read_incoming_links":{"requestMethod":"GET","rel":"read_incoming_links","url":"http://localhost:8080/therest/rest/record/metadataGroup/permissionRulePartOrganisationGroup/incomingLinks","accept":"application/uub+recordList+json"},"update":{"requestMethod":"POST","rel":"update","contentType":"application/uub+record+json","url":"http://localhost:8080/therest/rest/record/metadataGroup/permissionRulePartOrganisationGroup","accept":"application/uub+record+json"}}}} | OK |

*!
!***> Read recordType (user)

!| RecordEndpointFixture |
| type | id | testReadRecord? | getStatusType? |
| recordType | user | | OK |

*!
!2 Test with new user
!***> Create data of recordType user. Should fail since it is abstract

!| RecordEndpointFixture |
| type | id | json | testCreateRecord? | getStatusType? |
| user | fitnessUser | {"name":"systemOneUserNewGroup","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnessUser"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"cora"}]}]},{"name":"userId","value":"user123"},{"name":"userFirstname","value":"Some"},{"name":"userLastname","value":"User"},{"name":"userRole","value":"","repeatId":"0"}]} | | METHOD_NOT_ALLOWED |

*!
