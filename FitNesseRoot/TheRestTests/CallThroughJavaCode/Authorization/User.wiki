---
Prune
Test
---
!contents -R2 -g -p -f -h
| import |
| se.uu.ub.cora.therest.fitnesse |

!1 Testing User
The authority system of Cora is built using rules, roles, users.

A user describes what is allowed based on one or more roles, extended with ruleParts and a status. More information about Roles can be found  [[here.][Role]]

The system has one user used by fitnesse, it is called fitnesse, reading it results in the following:

!***> Read User, fitnesse

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| fitnesseToken | systemOneUser | fitnesse | | OK |

*!
The user fitnesse has one role fitnesse.

To show that changes to roles changes what is allowed, will we use texts as an example:

Create a new text to show that it '''is''' allowed:

!***> Create data of recordType text (textSystemOne)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? |
| fitnesseToken | textSystemOne | {"name":"text","children":[{"name":"recordInfo","children":[{"name":"id","value":"myUserText"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"}]},{"name":"textPart","attributes":{"type":"default","lang":"sv"},"children":[{"name":"text","value":"Min svenska text"}]}]} | | CREATED |

*!
!2 User status
Update user, set status to inactive

'''this is currently not possible as user does not have a status, fix!'''

!***> Update user, fitnesse, setting status to inactive

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| fitnesseToken | systemOneUser | fitnesse | {"name":"systemOneUserGroup","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesse"},{"name":"type","value":"systemOneUser"},{"name":"createdBy","value":"12345"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"userId","value":"fitnesse123"},{"name":"userFirstname","value":"Fit"},{"name":"userLastname","value":"Nesse"}]} | | OK |

*!
Create a new text to show that it is '''NOT''' allowed:

!***> Create data of recordType text (textSystemOne)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? |
| fitnesseToken | textSystemOne | {"name":"text","children":[{"name":"recordInfo","children":[{"name":"id","value":"myUserText"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"}]},{"name":"textPart","attributes":{"type":"default","lang":"sv"},"children":[{"name":"text","value":"Min  svenska text"}]}]} | | FORBIDDEN |

*!
!2 User removed role
Update user, to only have one role (metadataAdmin)

(here we must use a different user (role) as we currently have no permissions at all, using guest)

!***> Update user, fitnesse, setting status to inactive

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| guestToken | systemOneUser | fitnesse | {"name":"systemOneUserGroup","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesse"},{"name":"type","value":"systemOneUser"},{"name":"createdBy","value":"12345"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"userId","value":"fitnesse123"},{"name":"userFirstname","value":"Fit"},{"name":"userLastname","value":"Nesse"}]} | | OK |

*!
Create a new text to show that it is '''NOT''' allowed:

!***> Create data of recordType text (textSystemOne)

!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? |
| fitnesseToken | textSystemOne | {"name":"text","children":[{"name":"recordInfo","children":[{"name":"id","value":"myUserText"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"}]},{"name":"textPart","attributes":{"type":"default","lang":"sv"},"children":[{"name":"text","value":"Min  svenska text"}]}]} | | FORBIDDEN |

*!
!2 User change rule part connected to role
Update users, connected rule fitnesse to have a specific userId (system.aUserIdThatHasNotCreatedAnything)

!***> Update user, fitnesse, setting status to inactive

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| fitnesseToken | systemOneUser | fitnesse | {"name":"systemOneUserGroup","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesse"},{"name":"type","value":"systemOneUser"},{"name":"createdBy","value":"12345"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"userId","value":"fitnesse123"},{"name":"userFirstname","value":"Fit"},{"name":"userLastname","value":"Nesse"}]} | | OK |

*!
Try to update created text to see that it is '''NOT''' allowed

!***> Update  data of recordType text (textSystemOne)

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| fitnesseToken | textSystemOne | myUserText | {"children":[{"children":[{"name":"id","value":"myUserText"},{"children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"testSystem"}],"name":"dataDivider"},{"name":"type","value":"textSystemOne"},{"name":"createdBy","value":"12345"}],"name":"recordInfo"},{"children":[{"name":"text","value":"Min  svenska text"}],"name":"textPart","attributes":{"type":"default","lang":"sv"}}],"name":"text"} | | FORBIDDEN |

*!
!2 Reset user fitnesse
Update user, fitnesse to be as it was before testing

!***> Update user, fitnesse, restoring original state

!| RecordEndpointFixture |
| authToken | type | id | json | testUpdateRecord? | getStatusType? |
| fitnesseToken | systemOneUser | fitnesse | {"name":"systemOneUserGroup","children":[{"name":"recordInfo","children":[{"name":"id","value":"fitnesse"},{"name":"type","value":"systemOneUser"},{"name":"createdBy","value":"12345"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"userId","value":"fitnesse123"},{"name":"userFirstname","value":"Fit"},{"name":"userLastname","value":"Nesse"}]} | | OK |

*!
